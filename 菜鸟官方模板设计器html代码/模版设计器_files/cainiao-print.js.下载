var CAINIAO_PRINT=function(t){this.hosts="http:"==window.location.protocol?"ws://127.0.0.1:13528":"wss://localhost:13529",this.hosts="undefined"!=typeof t.hosts?t.hosts:this.hosts,this.notifyPrintResultHandler="function"==typeof t.notifyPrintResultHandler?t.notifyPrintResultHandler:this.notifyPrintResultHandler,this.socket=null,this.socketStatus=null,this.autoConnect="undefined"==typeof t.autoConnect||t.autoConnect,this.autoConnect&&this.doConnect(),this.windows=!1,this.ie=!1,this.created()};CAINIAO_PRINT.prototype={constructor:CAINIAO_PRINT,created:function(){var t=navigator.userAgent.toLowerCase();t.match(/windows nt ([\d.]+)/)?this.windows=!0:(console.log("\u975ewin\u64cd\u4f5c\u7cfb\u7edf\uff0c\u65e0\u6cd5\u5b89\u88c5\u6253\u5370\u63a7\u4ef6"),this.windows=!1)},doConnect:function(){var t=this;t.socket=new WebSocket(t.hosts),t.socket.onopen=function(e){t.socket.onmessage=function(e){var n=JSON.parse(e.data);switch(n.cmd){case"getPrinters":t.getPrintersHandler(n);break;case"getPrinterConfig":t.getPrinterConfigHandler(n);break;case"printerConfig":t.printerConfigHandler(n);break;case"resetPrinterPreferences":t.resetPrinterPreferencesHandler(n);break;case"setPrinterConfig":t.setPrinterConfigHandler(n);break;case"getTaskStatus":t.getTaskStatusHandler(n);break;case"getDocumentStatus":t.getDocumentStatusHandler(n);break;case"notifyPrintResult":t.notifyPrintResultHandler(n);break;case"getGlobalConfig":t.getGlobalConfigHandler(n);break;case"setGlobalConfig":t.setGlobalConfigHandler(n);break;case"getAgentInfo":t.getAgentInfoHandler(n);break;case"print":t.printHandler(n)}console.log("Client received a message",e)},t.socket.onclose=function(t){console.log("Client notified socket has closed",t)}}},getRequestObject:function(t){var e=new Object;return e.requestID=arguments[1]?arguments[1]:this.getUUID(),e.version="1.0",e.cmd=t,e},getUUID:function(){var t,e="undefined"==typeof e?8:e,n="undefined"==typeof n?16:n,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(n=n||r.length,e)for(t=0;t<e;t++)i[t]=r[0|Math.random()*n];else{var s;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",t=0;t<36;t++)i[t]||(s=0|16*Math.random(),i[t]=r[19==t?3&s|8:s])}return i.join("")},send:function(t){return null==this.socket?(console.log("err: not connect socket server yet!"),!1):void this.socket.send(JSON.stringify(t))},getPrinters:function(t){"function"==typeof t.handler&&(this.getPrintersHandler=t.handler),this.send(this.getRequestObject("getPrinters"))},getPrintersHandler:function(t){},getPrinterConfig:function(t){if(!t.printer)return"no printer";"function"==typeof t.handler&&(this.getPrinterConfigHandler=t.handler);var e=this.getRequestObject("getPrinterConfig");e.printer=t.printer,this.send(e)},getPrinterConfigHandler:function(t){},printerConfig:function(t){if(!t.printer)return"no printer";"function"==typeof t.handler&&(this.printerConfigHandler=t.handler);var e=this.getRequestObject("printerConfig");e.printer=t.printer,this.send(e)},printerConfigHandler:function(t){},resetPrinterPreferences:function(t){if(!t.printer)return"no printer";"function"==typeof t.handler&&(this.resetPrinterPreferencesHandler=t.handler);var e=this.getRequestObject("resetPrinterPreferences");e.printer=t.printer,this.send(e)},resetPrinterPreferencesHandler:function(t){},setPrinterConfig:function(t){if(!t.printer)return"no printer";"function"==typeof t.handler&&(this.setPrinterConfigHandler=t.handler);var e=this.getRequestObject("setPrinterConfig");e.printer=t.printer,this.send(e)},setPrinterConfigHandler:function(t){},getTaskStatus:function(t){if(!t.taskID)return"no taskID";"function"==typeof t.handler&&(this.getTaskStatusHandler=t.handler);var e=this.getRequestObject("getTaskStatus");e.taskID=t.taskID,this.send(e)},getTaskStatusHandler:function(t){},getDocumentStatus:function(t){if(!t.documentIDs)return"no documentIDs";"function"==typeof t.handler&&(this.getDocumentStatusHandler=t.handler);var e=this.getRequestObject("getDocumentStatus");e.documentIDs=t.documentIDs,this.send(e)},getDocumentStatusHandler:function(t){},notifyPrintResultHandler:function(t){},getGlobalConfig:function(t){"function"==typeof t.handler&&(this.getGlobalConfigHandler=t.handler);var e=this.getRequestObject("getGlobalConfig");this.send(e)},getGlobalConfigHandler:function(t){},setGlobalConfig:function(t){"function"==typeof t.handler&&(this.setGlobalConfigHandler=t.handler);var e=this.getRequestObject("setGlobalConfig");e.notifyOnTaskFailure="undefined"==typeof t.notifyOnTaskFailure||t.notifyOnTaskFailure,this.send(e)},setGlobalConfigHandler:function(t){},getAgentInfo:function(t){"function"==typeof t.handler&&(this.getAgentInfoHandler=t.handler);var e=this.getRequestObject("getAgentInfo");this.send(e)},getAgentInfoHandler:function(t){},printHandler:function(t){},doPrint:function(t){if("undefined"!=typeof t.task){"function"==typeof t.handler&&(this.printHandler=t.handler),t.task.taskID="undefined"!=typeof t.task.taskID&&""!=t.task.taskID?t.task.taskID:this.getUUID();var e=this.getRequestObject("print",t.task.taskID);e.task=t.task,this.send(e)}else console.log("no task")},print:function(t){t.task.preview=!1,this.doPrint(t)},printPdf:function(t){t.task.preview=!0,t.task.previewType="pdf",this.doPrint(t)},printImg:function(t){t.task.preview=!0,t.task.previewType="image",this.doPrint(t)}};